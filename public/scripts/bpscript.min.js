/*BlackPHP (c)2022 Edwin Fajardo.*/
$(function(){var t=$(window).height()-$("#main_header").outerHeight()-$("#main_footer").outerHeight();$(".list_options").length&&(t-=$(".list_options").outerHeight()),$("#main_nav").length&&$("#main_nav").css("width")==$("#main_nav").parent().css("width")&&(t-=$("#main_nav").outerHeight()),t>0&&($("#content_section").css("min-height",t+"px"),$(".content_viewer").css("height",t+"px")),$(".nav_link").each(function(){$(this).prop("href")==location.href&&$(this).addClass("nav_link_active")}),$(".nav_link").on("click",function(t){$(".nav_link_active").removeClass("nav_link_active"),$(this).addClass("nav_link_active")}),$("#user_link").on("click",function(){$("#main_aside").slideToggle("fast")}),$("#u_close").on("click",function(){$.ajax({method:"GET",url:"User/logout/",dataType:"json"}).done(function(t){t.session?$.jAlert({title:"Error",content:"No se ha podido cerrar sesi\xf3n",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]}):location.href="/"}).fail(function(){$.jAlert({title:"Error",content:"No se ha podido cerrar sesi\xf3n",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]})})}),$("a").not(".link_exclude").on("click",function(e){e.preventDefault();var a=$(this).attr("href");if("#"==a)return!1;if("#alert"==a){var n=$(this).data("href");return $.jAlert({title:$(this).data("title")||!1,theme:$(this).data("theme")||"blue",iframe:n,size:{height:t+"px",width:"100%"},iframeHeight:t-41+"px",noPadContent:!0}),!1}if(0==a.indexOf("#")||$(this).prop("href")==location.href)return!1;0==a.indexOf("http")?window.open(a,"_blank"):window.location.href=a}),url=function t(){var e=$(location).attr("pathname");0==e.indexOf("/")&&(e=e.substring(1)),"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var a=e.split("/"),n={module:a[0],method:a[1],id:a[2],options:{}};if(a.length>3)for(i=2;i<a.length;i+=2)n.options[a[i]]=a[i+1];return n}(),connection_fails=0,setInterval(function t(){$.ajax({method:"POST",url:"Resources/keep_alive/",data:url,dataType:"json"}).done(function(t){t.alive?connection_fails=0:location.reload()}).fail(function(){++connection_fails>1&&location.reload()})},3e4),$(".link_button").on("click",function(){location.href=$(this).data("href")}),set_date_picker=function(){$(this).removeClass("hasDatepicker"),$(this).removeAttr("id"),$(this).datepicker({dateFormat:$(this).data("format")||"dd/mm/yy",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Deciembre"],dayNamesMin:["Dom","Lun","Mar","Mie","Jue","Vie","Sab"]})},$(".date_input").each(set_date_picker),window.onbeforeprint=function(){$(".content_viewer").css({"overflow-y":"auto",height:"auto"})},$(".menu_item").on("click",function(){$(this).css({opacity:"0.1",transform:"scale(2)"})}),$("#nav_content a").each(function(){(a_module=$(this).attr("href").replace("/",""))==url.module&&$(this).addClass("nav_link_active")}),$("body").on("keydown",t=>{("I"==t.key||"i"==t.key)&&t.altKey&&(location.href="/")}),$(document).tooltip(),$("#menu_button").on("click",function(){"#"==$(this).attr("href")&&$("#main_nav").slideToggle("slow")}),$("#tabs").accordion({collapsible:!0,heightStyle:"content",activate:function(){$("textarea").trigger("input")}}),$(".back_button").on("click",function(){history.back()})}),$(function(){function t(){null==url.method&&(url.method="listar");var t=url.module+"/"+url.method+"/";$.each(url.options,function(e,a){null!=a&&0!=a&&(t+=e+"/"+a+"/")}),location.href=t}function e(t){(div=$(document.createElement("div"))).css("width","720px"),div.html(t),$("body").append(div);var e=div.width(),a=div.height(),n=e+96,o=e,r=a,c=Math.ceil(a/1054)-1;html2canvas(div[0],{allowTaint:!0,scale:2}).then(function(t){t.getContext("2d"),console.log(t.height+"  "+t.width);var e=t.toDataURL("image/jpeg",1),a=new jsPDF("p","pt",[n,1054]);a.addImage(e,"JPG",48,48,o,r);for(var l=1;l<=c;l++)a.addPage(n,1054),a.addImage(e,"JPG",48,-(1054*l)+192,o,r);a.save("HTML-Document.pdf")}),div.remove()}null!=window.jspdf&&(window.jsPDF=window.jspdf.jsPDF),$(".data_viewer").each(function(){(function e(a){var n=$("#"+a),o=n.find(".template").clone().removeClass("template").prop("outerHTML");$.ajax({method:"POST",url:url.module+"/"+a+"_loader/",data:url,dataType:"json"}).done(function(e){if(null!=e.content&&($.each(e.content,function(t,e){var n=o;$.each(e,function(t,e){n=n.replace(RegExp("{{"+t+"}}","g"),e)}),$("#"+a+" tbody").append(n)}),$("#"+a+" tbody tr").on("click",function(){$(this).data("href")&&(location.href=$(this).data("href")+"/"+$(this).data("id")+"/")}),e.foot&&$.each(e.foot,function(t,e){tr=(tr=$("#"+a+" tfoot").html()).replace(RegExp("{{"+t+"}}","g"),e),$("#"+a+" tfoot").html(tr)})),null!=e.found_rows){var r=0;r=null==url.options.page?e.found_rows>0?1:0:url.options.page,$(".pagination").jqPagination({paged:function(e){url.options.page=e,t()},max_page:Math.ceil(e.found_rows/100),current_page:r,page_string:"{current_page} / {max_page}"})}n.show(),n.data("type")||n.floatThead({scrollContainer:!0}),e.load_after&&$.each(e.load_after,function(t,e){$("."+t).text(e)})}).fail(function(){$("div.loading_error").show()}).always(function(){$("div.loading_data").hide()})})($(this).attr("id"))}),$(".data_table").each(function(){(function t(e){var a=$("#"+e),n=a.find(".template").clone().removeClass("template").prop("outerHTML");$.ajax({method:"POST",url:url.module+"/"+e+"_loader/",data:url,dataType:"json"}).done(function(t){null!=t.content&&($.each(t.content,function(t,a){var o=n;$.each(a,function(t,e){o=o.replace(RegExp("{{"+t+"}}","g"),e)}),$("#"+e+" tbody").append(o)}),$("#"+e+" tbody tr").on("click",function(t){$(this).data("href")&&(location.href=$(this).data("href")+"/"+$(this).data("id")+"/")}),t.foot&&$.each(t.foot,function(t,a){tr=(tr=$("#"+e+" tfoot").html()).replace(RegExp("{{"+t+"}}","g"),a),$("#"+e+" tfoot").html(tr)})),a.find("tr.template").remove();var o=a.DataTable({responsive:!0,paging:!1,fixedHeader:{header:!0,footer:!0},scrollY:$(".content_viewer").height()-65,language:{url:"/Resources/datatables_language/"+$("html").attr("lang")},dom:"lrtip"});t.load_after&&$.each(t.load_after,function(t,e){$("."+t).text(e)}),$(".data_search").on("keyup",function(){o.search($(this).val()).draw()})}).fail(function(){$("div.loading_error").show()}).always(function(){$("div.loading_data").hide()})})($(this).attr("id")),$(".content_viewer").css("overflow","hidden")}),$(".content_loader").each(function(){var t,a;t=$(this).attr("id"),a=$("#"+t),module=url.module||"index",$.ajax({method:"POST",url:module+"/"+t+"_loader/",data:url,dataType:"html"}).done(function(t){a.html(t),$(".menu_item").on("click",function(){$(this).css({opacity:"0.1",transform:"scale(2)"})}),$("#main_content").has(".details_content").addClass("details_main_content"),$(".close_details").on("click",function(t){t.preventDefault(),$(".details_content").css({opacity:"0.1",transform:"scale(0.1)"}),history.back()}),$(".link_button").on("click",function(){location.href=$(this).data("href")}),a.find(".print_button").on("click",function(){print_header=null,$(".print_header").length&&(print_header=$(".print_header").html()),print_footer=null,$(".print_footer").length&&(print_footer=$(".print_footer").html()),$($(this).data("print")).printThis({loadCSS:$(this).data("css")||"",header:print_header,footer:print_footer})}),a.find(".pdf_button").on("click",function(){var t="",a="";$(".print_header").length&&(a=$(".print_header").html());var n="";$(".print_footer").length&&(n=$(".print_footer").html()),e(t=a+$($(this).data("content")).html()+n)}),$(".open_dialog_button").on("click",function(){$("#"+$(this).data("dialog")).dialog("open")}),$(".delete_button").length&&$(".delete_button").on("click",delete_button_click),a.find(".data_viewer").show(),$(".link_row").on("click",function(){"#"!=$(this).data("href")&&(location.href=$(this).data("href"))}),$(".myChart").length>0&&init_chart()}).fail(function(){$("div.loading_error").show()}).always(function(){$("div.loading_data").hide()})}),$(".data_viewer").length&&$(".data_search").on("keyup",function(){var t=$(this).val();$(".data_viewer tbody tr").not(".template").each(function(){found=!1,$(this).find("td").each(function(){$(this).text().toUpperCase().indexOf(t.toUpperCase())>=0&&(found=!0)}),found?$(this).show():$(this).hide()})}),$(".data_filter").each(function(){var e,a,n;$(this).is("select")?(e=$(this).attr("id"),a=url.module||"index",n=$("#"+e),null!=n.data("module")&&(a=n.data("module")),$.ajax({method:"POST",url:a+"/"+e+"_loader/",data:url,dataType:"json"}).done(function(e){if(e.results){var a={data:e.results,dropdownAutoWidth:!0,placeholder:n.data("placeholder")||"",width:n.data("width")||"fit-content"};("none"!=n.data("search")||"none"==n.data("default"))&&(item=$(document.createElement("option"))).appendTo(n),"none"==n.data("search")&&(a.minimumResultsForSearch=1/0),n.select2(a),null!=n.data("value")&&(n.val(n.data("value")),n.trigger("change.select2")),n.data("identifier")&&(url.options[n.data("identifier")]&&(n.val(url.options[n.data("identifier")]),n.trigger("change.select2")),n.on("change",function(){url.options[n.data("identifier")]=n.val(),t()}))}}).fail(function(){n.hide()}).always(function(){})):$(this).on("change",function(){$(this).is(".date_input")&&($(this).data("value",$(this).val()),$(this).val($.datepicker.formatDate("yy-mm-dd",$(this).datepicker("getDate")))),url.options[$(this).data("identifier")]=$(this).val(),t()})}),$(".print_button").on("click",function(){$(".data_viewer").length>0&&$($(this).data("print")).floatThead("destroy");var t=null;$(".print_header").length&&(t=$(".print_header").html());var e=null;$(".print_footer").length&&(e=$(".print_footer").html());var a="public/styles/print_list.css?r="+Math.floor(1e5*Math.random());void 0!==$($(this).data("print")).data("css")&&(a=$($(this).data("print")).data("css")),$($(this).data("print")).printThis({loadCSS:a,header:t,footer:e})}),$(".pdf_button").on("click",function(){$(".data_viewer").length>0&&$($(this).data("print")).floatThead("destroy");var t="",a="";$(".print_header").length&&(a=$(".print_header").html());var n="";$(".print_footer").length&&(n=$(".print_footer").html()),t=a,$($(this).data("content")).each(function(){t+=$(this).html()}),e(t+=n)})}),$(function(){function t(){$(".data_selector:not(.select2-hidden-accessible)").each(function(){var t=$(this);if(900>$(window).width()&&t.data("width","100%"),null!=json[t.data("source")]){("none"!=t.data("search")||"none"==t.data("default"))&&(item=$(document.createElement("option"))).appendTo(t);var e={data:json[t.data("source")],dropdownAutoWidth:!0,placeholder:t.data("placeholder")||"",width:t.data("width")||"fit-content"};"none"==t.data("search")&&(e.minimumResultsForSearch=1/0),t.select2(e),null!=t.data("value")&&(t.val(t.data("value")),t.trigger("change.select2"))}}),$("#bill_type").trigger("change"),$(".entry_selector").trigger("change"),building_entry_selector=!1}function e(t){t.fadeIn(),setTimeout(function(){t.fadeOut("slow")},5e3)}function a(t){var e=t.closest("tr").find(".row_quantity").val(),a=t.closest("tr").find(".row_price").val(),n=t.closest("tr").find(".row_total").find("span");""!=e||isNaN(a)?isNaN(e)||isNaN(a)?n.text("0.00"):n.text((e*a).toFixed(2)):n.text(parseFloat(a).toFixed(2))}function n(e){if(13==e.which){var c=$(this).closest("tbody");if(c.is(".locked_tbody"))return!1;if($(this).closest("tr").is(":last-child")){var l=$(this).closest("tr").find(".row_price"),s=$(this).closest("tr").find(".row_product_name");if(""==s.val())return s.focus(),!1;if(""==l.val())return l.focus(),!1;$(this).closest("tr").find(".data_selector").each(function(){$(this).select2("destroy")});var d=$(this).closest("tr").clone();c.append(d),d.find(".row_count").text(c.find("tr").length),d.find("input").first().trigger("focus"),d.find("input").val(""),d.find("textarea").val(""),d.find(".row_number").val(c.find("tr").length-1),d.find(".clearable").text(""),d.find(".date_input").each(set_date_picker),d.find("input").on("keypress",n),d.find(".row_quantity, .row_price").on("change",function(){a($(this)),o()}),d.find(".row_total").find("span").text("0.00"),d.find(".delete_row_icon").on("click",delete_row_click),$(".delete_row_icon").css({visibility:"visible"}),d.find(".complete_value").text(""),d.find(".complete_value").on("click",f),d.find(".partial_value").show(),d.find(".partial_value").on("blur",h),d.find(".partial_value").on("change",p),d.find(".row_generics").text(""),d.find(".local_code").on("change",m),r(d),t()}return!1}}function o(){var t=0;$(".row_total").each(function(){t+=parseFloat($(this).find("span").text())}),$("#subtotal").val(format_number(t)),$("#iva").val(format_number(.13*t)),2==bill_type?$("#total").val(format_number(1.13*t)):$("#total").val(format_number(t)),$("#paid_amount_input").trigger("change")}function r(t=$("body")){t.find(".list_input").each(function(){var t=json[$(this).data("source")].map(function(t){return null==t.label&&(t.label=t.text),t});$(this).autocomplete({source:t,select:function(t,e){if(e.item.id||e.item.local_code){var n=$(this).closest(".autocomplete_container");0==n.length&&(n=$(this).closest("tr")),$.each(e.item,function(t,e){n.find("input."+t).val(e),n.find("textarea."+t).val(e),n.find("select."+t).data("value",e),n.find("span."+t).text(e)}),2==bill_type&&n.find(".sale_price").val(e.item.nvat_price),n.find(".row_available").text(e.item.quantity),""==n.find(".row_quantity").val()&&n.find(".row_quantity").val(1),a(n),o(),e.item.combo_id?setTimeout(c,50,n,e.item.combo_id):n.find(".row_generics").html("")}},change:function(t,e){e.item||($(this).val(""),$(this).trigger("change"))},autoFocus:!0}),$(this).on("click",function(){$(this).trigger("select")})})}function c(t,e){var a=t;$.ajax({method:"GET",url:url.module+"/generic_by_combo/"+e,dataType:"json"}).done(function(t){a.find(".row_generics").html(""),$.each(t,function(t,e){var n=$(document.createElement("div")),o=$(document.createElement("span"));o.text(e.product_name+":"),n.append(o);var r=$(document.createElement("select"));r.attr("name","generics[]"),n.append(r),a.find(".row_generics").append(n),$.each(e.options,function(t,e){var a=$(document.createElement("option"));a.attr("value",e.product_id),a.text(e.product_name),r.append(a)})})}).fail(function(){}).always(function(){})}function l(){$.ajax({method:"POST",url:deletion_url,data:url,dataType:"json"}).done(function(t){t.deleted?$.jAlert({title:t.title||"Success",content:t.message||"Deleted succesfully!",theme:"blue",autofocus:".jalert_accept",btns:[{text:t.accept||"OK",closeAlert:!0,theme:"blue",class:"jalert_accept",onClick:function(){location.href=deletion_next}}]}):t.message?$.jAlert({title:t.title||"Message",content:t.message,theme:t.theme||"red",autofocus:".jalert_accept",btns:[{text:t.accept||"OK",closeAlert:!0,theme:t.theme||"red",class:"jalert_accept"}]}):$.jAlert({title:"Error",content:"Failed to delete.",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]})}).fail(function(){}).always(function(){})}function s(t){null==last_form||t.no_reset||(last_form.trigger("reset"),last_form.find(".data_selector").val("").trigger("change"),last_form.find(".clearable").text(""),last_form.find(".deletable").not(":first").remove())}function d(t){t.preventDefault(),delete_button=$(this),$.jAlert({title:"Confirmar",content:"\xbfEst\xe1 seguro de que desea eliminar la entrada?",theme:"red",autofocus:".jalert_cancel",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept",onClick:function(){delete_button.closest(".form_entry").remove()}},{text:"Cancelar",closeAlert:!0,theme:"darkgray",class:"jalert_cancel"}]})}function u(){selected=[],$(".unique_selection").each(function(){selected[selected.length]=$(this).val()}),$(".unique_selection option").each(function(){$(this).removeAttr("disabled")}),$(".unique_selection").each(function(){selected_val=$(this).val(),(selector=$(this)).find("option").each(function(){$.inArray($(this).val(),selected)>=0&&selected_val!=$(this).val()&&$(this).attr("disabled",!0)}),selector.select2()})}function h(){$(this).val().length>0&&($(this).siblings(".complete_value").text($(this).val()),$(this).siblings(".complete_value").css("display","inline-block"),$(this).hide())}function f(){var t=$(this).siblings(".partial_value").first();t.show(),t.trigger("focus"),t.trigger("select"),$(this).css("display","none")}function p(){$(this).siblings(".complete_value").text($(this).val()),0==$(this).val().length&&($(this).siblings(".complete_value").hide(),$(this).show())}function m(){local_code=$(this).val(),list_input=$(this).closest("tr").find(".list_input"),items=json[list_input.data("source")],$.each(items,function(t,e){e.local_code!=local_code&&e.barcode!=local_code||e.pres_id||(list_input.val(e.product_name),list_input.data("ui-autocomplete")._trigger("select","autocompleteselect",{item:e}))})}new_item_row=$(".item_row").first().clone(!0),json=[],action_module="index",null!=url.module&&""!=url.module&&(action_module=url.module),$("#main_content").has(".form_content").addClass("form_main_content"),building_entry_selector=!0,$.ajax({method:"POST",url:action_module+"/load_form_data/",data:url,dataType:"json"}).done(function(e){if((json=e).update&&($(".update_input").each(function(){$(this).val(json.update[$(this).attr("name")]),$(this).data("value",json.update[$(this).attr("name")]),null!=$(this).data("cat_source")&&($(this).data("default_value",json.update[$(this).attr("name")]),$(this).data("default_cat",json.update[$($(this).data("cat_source")).attr("name")]))}),$(".update_radio").each(function(){json.update[$(this).attr("name")]==$(this).attr("value")?$(this).attr("checked","checked"):$(this).removeAttr("checked")}),$(".update_ucheck").each(function(){1==parseInt(json.update[$(this).attr("name")])?$(this).attr("checked","checked"):$(this).removeAttr("checked")}),$(".update_text").each(function(){$(this).text(json.update[$(this).data("id")])})),$(".age_input").trigger("change"),json.check&&$(".update_check").each(function(){var t=$(this);if(json.check[t.data("source")]){var e=!1;$.each(json.check[t.data("source")],function(a,n){n.id==t.attr("value")&&(t.attr("checked","checked"),e=!0)}),e||t.removeAttr("checked")}}),json.items&&($(".items_container").each(function(){var t=$(this);if(json.items[t.data("source")]&&json.items[t.data("source")].length>0){var e=t.find("tr").first().clone(!0);t.find("tr:first").first().remove(),row_count=0,$.each(json.items[t.data("source")],function(c,l){var s=e.clone(!1);s.find(".date_input").each(set_date_picker),s.find("input").on("keypress",n),s.find(".row_quantity, .row_price").on("change",function(){a($(this)),o()}),s.find(".delete_row_icon").on("click",delete_row_click),r(s),s.find(".row_number").val(row_count),s.find(".row_count").text(++row_count),s.find(".row_available").text(l.available),s.find(".row_quantity").val(l.quantity),s.find(".row_price").val(l.price),$.each(l,function(t,e){s.find("input."+t).val(e),s.find("textarea."+t).val(e),s.find("select."+t).data("value",e),s.find("span."+t).text(e)}),l.pres_id&&s.find(".pres_id").val(l.pres_id),a(s),t.append(s),s.find("input").first().trigger("focus"),s.find(".complete_value").text(l.product_name),s.find(".complete_value").on("click",f),s.find(".complete_value").css("display","inline-block"),s.find(".partial_value").hide(),s.find(".partial_value").on("blur",h),s.find(".partial_value").on("change",p),s.find(".row_generics").text("")}),row_count>1&&$(".delete_row_icon").css({visibility:"visible"}),o()}}),$(".current").on("change",calculate_consumption),$(".current").trigger("change")),json.presentations)for(i=0,trs=$("#pres_container tr");i<trs.length&&i<json.presentations.length;i++){var c=json.presentations[i];(_tr=$(trs.get(i))).find(".pres_id").val(c.pres_id),_tr.find(".pres_name").val(c.pres_name),_tr.find(".pres_price").val(c.price),_tr.find(".pres_units").val(c.units)}if(null!=json.found_rows){var l=0;l=null==url.options.page?json.found_rows>0?1:0:url.options.page,$(".pagination").jqPagination({paged:function(t){url.options.page=t,null==url.method&&(url.method="listar"),href=url.module+"/"+url.method+"/",$.each(url.options,function(t,e){null!=e&&(href+=t+"/"+e+"/")}),location.href=href},max_page:Math.ceil(json.found_rows/100),current_page:l,page_string:"{current_page} / {max_page}"})}t(),r(),$(".unique_selection").on("change",function(){setTimeout(u,500)}),u(),$("textarea").trigger("input")}).fail(function(){}).always(function(){}),close_dialog=null,add_selector=null,last_form=null,duplicate=!1,$("form").on("submit",function(t){if(t.preventDefault(),duplicate)return!1;if(duplicate=!0,setTimeout(function(){duplicate=!1},5e3),a="",n=!0,$(".equal_value").each(function(){""==a?a=$(this).val():$(this).val()!=a&&($.jAlert({title:"Error",content:"Las contrase\xf1as no coinciden",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]}),n=!1)}),!n)return!1;var a,n,o=$(this).attr("action")||"save";$(this).find(".date_input").each(function(){$(this).data("value",$(this).val()),$(this).val($.datepicker.formatDate("yy-mm-dd",$(this).datepicker("getDate")))});var r=new FormData(this);first_input=$(this).find("input").first(),div_sending=$(this).siblings(".sending"),div_success=$(this).siblings(".success"),div_error=$(this).siblings(".error"),div_sending.show(),close_dialog=$(this).data("close_dialog"),add_selector=$(this).data("selector"),last_form=$(this),null!=$(this).data("module")&&(action_module=$(this).data("module"));var c={xhr:function(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;$(".progress-bar").width(e+"%"),$(".progress-bar").html(e+"%")}},!1),t},beforeSend:function(){$(".progress-bar").width("0%"),$(".progress-bar").html("0%")},method:"POST",url:action_module+"/"+o+"/",data:r,dataType:"json",processData:!1,contentType:!1};$.ajax(c).done(function(t){var a,n;t.message&&$.jAlert({title:t.title,content:t.message,theme:t.theme,autofocus:".jalert_accept",onClose:function(){first_input.focus(),t.reload_after&&location.reload(),t.print_after&&($(".form_body").printThis(),$(".reload_button").show(),$(".reload_button").siblings().hide()),t.redirect_after&&(s(t),location.href=t.redirect_after)},btns:[{text:t.accept||"Accept",closeAlert:!0,theme:t.theme,class:"jalert_accept"}]}),t.success||t.saved?(a=t,n=div_success,n.fadeIn(),null!=add_selector&&(source=$("#"+add_selector).data("source"),json[source][json[source].length]=a,$("#"+add_selector).select2({data:json[source]}),$("#"+add_selector).val(a.id).trigger("change")),null==close_dialog||a.reload_after?setTimeout(function(){n.fadeOut("slow")},5e3):($("#"+close_dialog).dialog("close"),close_dialog=null),s(a)):null!=t.next?(s(t),location.href=t.next):t.reload?location.reload():e(div_error)}).fail(function(){e(div_error)}).always(function(){div_sending.hide(),$(".date_input").each(function(){null!=$(this).data("value")&&($(this).val($(this).data("value")),$(this).removeAttr("data-value"))})})}),$("form .cancel_button").on("click",function(){$(this).closest("form").data("reset")&&($(".form_content").css({opacity:"0.1",transform:"scale(0.1)"}),history.back())}),$(".close_form").on("click",function(t){t.preventDefault(),$(".form_content").css({opacity:"0.1",transform:"scale(0.1)"}),history.back()}),$(window).on("beforeprint",function(){$("input, textarea").each(function(){$(this).parent().find(".no_screen").text($(this).val())}),$("select").each(function(){$(this).parent().find(".no_screen").text($(this).find("option:selected").text())})}),bill_type=1,$(".row_quantity, .row_price").on("change",function(){a($(this)),o()}),$(".details_table input").on("keypress",n),format_number=function(t){var e;return new Number(t).toLocaleString("en-US",{style:"currency",currency:"USD"}).slice(1)},$("#bill_type").on("change",function(){var t=$(this).val();2==t?$("#vat_total, #subtotal_div").show():$("#vat_total, #subtotal_div").hide();var e=$(this).select2("data")[0];$("#bill_number").val(e.next),""==t&&JSON.ticket++,bill_type=t}),$(".classifier_input").on("change",function(){$(".content_viewer").css("visibility","hidden"),$(".classifier_button").show(),$(".print_button").hide()}),$("#paid_amount_input").on("change",function(){var t=parseFloat($(this).val()),e=$("#total").val();e=parseFloat(e.replace(",",""));var a=t-e;isNaN(a)?$("#change_input").val(""):$("#change_input").val(a.toFixed(2))}),delete_button_click=function(){deletion_url=$(this).data("url"),deletion_next=$(this).data("next"),$.jAlert({title:"Confirmar",content:"\xbfConfirma que desea borrar este registro?",theme:"red",autofocus:".jalert_cancel",btns:[{text:"Confirmar",closeAlert:!0,theme:"red",class:"jalert_accept",onClick:l},{text:"Cancelar",closeAlert:!0,theme:"gray",class:"jalert_cancel"}]})},$(".delete_button").on("click",delete_button_click),$(".reload_button").on("click",function(){location.reload()}),delete_row_click=function(t){if(t.preventDefault(),delete_button=$(this),(row_count=(tbody=$(this).closest("tbody")).find("tr").length)<2)return!1;$.jAlert({title:"Confirmar",content:"\xbfEst\xe1 seguro de que desea eliminar la fila?",theme:"red",autofocus:".jalert_cancel",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept",onClick:function(){null!=(product_id=delete_button.closest("tr").find(".product_id").val())&&""!=product_id&&(removed=delete_button.closest("tr").find(".item_id").val(),(input=$(document.createElement("input"))).val(removed),input.attr("name","removed[]"),input.attr("type","hidden"),delete_button.closest("form").append(input)),null!=(service_id=delete_button.closest("tr").find(".service_id").val())&&""!=service_id&&(removed=delete_button.closest("tr").find(".item_id").val(),(input=$(document.createElement("input"))).val(removed),input.attr("name","removed_services[]"),input.attr("type","hidden"),delete_button.closest("form").append(input)),delete_button.closest("tr").remove(),o(),row_count=0,tbody.find(".row_count").each(function(){$(this).text(++row_count)}),row_number=0,tbody.find(".row_number").each(function(){$(this).val(row_number++)}),row_count<2&&$(".delete_row_icon").css({visibility:"hidden"})}},{text:"Cancelar",closeAlert:!0,theme:"darkgray",class:"jalert_cancel"}]})},$(".delete_row_icon").on("click",delete_row_click),$(".code_generator").on("change",function(){var t=$(this).select2("data")[0],e=$($(this).data("code_input"));null!=e.data("default_cat")&&t.id==e.data("default_cat")?e.val(e.data("default_value")):null!=t.next&&e.val(""+t.category_prefix+t.next+t.category_suffix)}),$(".add_row_button").on("click",function(){var e=$($(this).data("tbody"));null==e&&(e=$(".items_container").first());var c=e.find("tr").last();c.find(".data_selector").each(function(){$(this).select2("destroy")}),_tr=c.clone(),e.append(_tr),_tr.find(".row_count").text(e.find("tr").length),_tr.find("input").first().focus(),_tr.find("input").val(""),_tr.find("textarea").val(""),_tr.find(".row_number").val(e.find("tr").length-1),_tr.find(".date_input").each(set_date_picker),_tr.find("input").keypress(n),_tr.find(".row_quantity, .row_price").change(function(){a($(this)),o()}),_tr.find(".row_total").find("span").text("0.00"),_tr.find(".delete_row_icon").click(delete_row_click),_tr.find(".clearable").text(""),$(".delete_row_icon").css({visibility:"visible"}),_tr.find(".complete_value").text(""),_tr.find(".complete_value").click(f),_tr.find(".row_generics").text(""),_tr.find(".partial_value").show(),_tr.find(".partial_value").blur(h),_tr.find(".partial_value").change(p),_tr.find(".local_code").change(m),r(_tr),t()}),$(".add_entry_button").on("click",function(){var e=$($(this).data("container")),a=e.find(".form_entry").last();a.find(".data_selector").each(function(){$(this).data("value",$(this).val()),$(this).select2("destroy")});var n=a.clone();e.append(n),n.find(".entry_count").text(e.find(".form_entry").length),n.find("input").first().trigger("focus"),n.find("input, select, textarea").val(""),n.find(".date_input").each(set_date_picker),n.find(".delete_entry_icon").on("click",d),n.find(".extra_data").text(""),$(".delete_entry_icon").css({visibility:"visible"}),r(n),t(),n.find(".image-upload").each(function(){$(this).imageReader()}),n.find(".image-preview").html("")}),$(".delete_entry_icon").on("click",d),$(".input-images").length&&$(".input-images").imageUploader({label:"Arrastre aqu\xed una imagen, o haga click para buscarla.",maxFiles:1}),$(".entry_selector").on("change",function(t){var e=$(t.target).val(),a=$(".hidden_entry"),n=$(".entry_type_"+e);if(null!=$(this).data("target")){var o=$($(this).data("target"));a=o.find(".hidden_entry"),n=o.find(".entry_type_"+e)}a.hide(),a.find("input").each(function(){building_entry_selector||$(this).val(""),$(this).removeAttr("required")}),a.find("select").each(function(){building_entry_selector||$(this).val(""),$(this).removeAttr("required")}),n.show(),$(n).find("input").each(function(){null!=$(this).data("required")&&$(this).attr("required",!0)}),$(n).find("select").each(function(){null!=$(this).data("required")&&$(this).attr("required",!0)})}),$(".entry_selector").each(function(){var t=$(".entry_type_"+$(this).data("default"));null!=$(this).data("target")&&(t=$($(this).data("target")).find(".entry_type_"+$(this).data("default"))),t.show()}),$("textarea").each(function(){min_height=30,(min_height=this.scrollHeight>this.style.height?this.scrollHeight:this.style.height)<30&&(min_height=30),this.setAttribute("style","height:"+min_height+"px;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),$(".age_input").on("change",function(){if(""==$(this).val())return!0;date=$.datepicker.formatDate("yy-mm-dd",$(this).datepicker("getDate")),age_span=$(this).next("span"),$.ajax({method:"GET",url:"Resources/age_calculation/"+date,dataType:"json"}).done(function(t){t.age&&age_span.text(t.age)}).fail(function(){}).always(function(){})}),$(".partial_value").on("blur",h),$(".complete_value").on("click",f),$(".partial_value").on("change",p),$(".image-upload").each(function(){$(this).imageReader()}),$(".local_code").on("change",m),$(".check_identifier").on("change",function(){$(".identifier_clean").val(""),check_url=url.module+"/check_identifier/"+$(this).val(),null!=$(".list_selector").val()&&""!=$(".list_selector").val()&&(check_url+="/"+$(".list_selector").val()+"/"),$.ajax({method:"GET",url:check_url,dataType:"json"}).done(function(t){t.found&&$.jAlert({title:"Entrada duplicada",content:"El(la) sr(a) "+t.complete_name+" ya se encuentra en la lista seleccionada.",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]}),$.each(t,function(t,e){$("."+t).val(e)})}).fail(function(){}).always(function(){})}),calculate_consumption=function(){tr=$(this).closest("tr");var t=parseInt(tr.find(".previous").text()),e=parseInt($(this).val()),a=tr.find(".consumption");if(isNaN(t)||isNaN(e))return!1;(consumption=e-t)<0?($.jAlert({title:"Error",content:"La lectura no puede ser inferior a "+t+".",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]}),a.text("")):a.text(consumption)}}),$(function(){dialog_width=500,600>$(window).width()&&(dialog_width=-1!=navigator.userAgent.indexOf("AppleWebKit")?"-webkit-fill-available":"-moz-available"),$.extend($.ui.dialog.prototype.options,{modal:!0,autoOpen:!1,show:{effect:"explode",duration:500},hide:{effect:"explode",duration:500},width:dialog_width,maxWidth:500,open:function(){$("#container").css("opacity","0.2")},close:function(){var t=$(this).find("form");t.trigger("reset"),$("#container").css("opacity","1"),t.find("select").trigger("change.select2")}}),$.ui.dialog.prototype._allowInteraction=function(t){return!0},$(".open_dialog_button").on("click",function(){$("#"+$(this).data("dialog")).dialog("open")}),$(".dialog").each(function(){options={buttons:[{text:$(this).data("accept")||"Accept",click:function(t){$(this).find("form").trigger("submit")}},{text:$(this).data("close")||"Close",click:function(){$(this).dialog("close")}}]},$(this).dialog(options),$(this).data("reload")&&$(this).dialog("option","close",function(){location.reload()})})}),$(function(){function t(){var t=0;$(".order_item").each(function(){t+=$(this).find(".price_input").val()*$(this).find(".quantity_input").val()}),$("#form_total").text(t.toFixed(2))}$(".price_input, .quantity_input").on("change",t),$(".order_item a").on("click",function(){var e=$(this).parent().find(".quantity_input"),a=""==e.val()?0:parseInt(e.val());e.val(a+1),t()})}),$(function(){$(".parent_checkbox").on("click",function(){$(this).closest(".parent_item").find(".child_checkbox").prop("checked",$(this).prop("checked"))}),$(".child_checkbox").on("click",function(){var t=$(this).closest(".parent_item").find(".parent_checkbox"),e=$(this).closest(".children_container");$(this).prop("checked")?t.prop("checked",!0):0==e.find("input:checked").length&&t.prop("checked",!1)}),$(".children_container").sortable()}),$(function(){init_chart=function(){$(".myChart").each(function(){var t,e,a,n;t=$(this),e=new Chart(t,{type:"bar",data:{labels:t.data("labels").split(","),datasets:[{label:"Metros c\xfabicos",data:t.data("data").split(","),backgroundColor:["#666","#666","#666","#666","#666","#666"]}]},options:{scales:{y:{beginAtZero:!0}},plugins:{datalabels:{anchor:"end",align:"top",formatter:Math.round,font:{weight:"bold"}}}},plugins:[ChartDataLabels],legend:{display:!1},tooltips:{callbacks:{label:t=>`${t.yLabel}: ${t.xLabel}`,title:()=>null}}}),a=t.parent().next(".small_chart").first(),n=$(document.createElement("img")),n.attr("src",e.toBase64Image()),n.css("width","100%"),a.html(n),t.parent().remove()})}});;
