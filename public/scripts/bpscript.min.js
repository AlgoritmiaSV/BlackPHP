/*BlackPHP (c)2022 Edwin Fajardo.*/
$(function(){var a=$(window).height()-$("#main_header").outerHeight()-$("#main_footer").outerHeight();$(".list_options").length&&(a-=$(".list_options").outerHeight()),$("#main_nav").length&&$("#main_nav").css("width")==$("#main_nav").parent().css("width")&&(a-=$("#main_nav").outerHeight()),a>0&&($("#content_section").css("min-height",a+"px"),$(".content_viewer").css("height",a+"px")),$(".nav_link").each(function(){$(this).prop("href")==location.href&&$(this).addClass("nav_link_active")}),$(".nav_link").click(function(a){$(".nav_link_active").removeClass("nav_link_active"),$(this).addClass("nav_link_active")}),$("#user_link").click(function(){$("#main_aside").slideToggle("fast")}),$("#u_close").click(function(){$.ajax({method:"GET",url:"user/logout/",dataType:"json"}).done(function(a){a.session?$.jAlert({title:"Error",content:"No se ha podido cerrar sesi\xf3n",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]}):location.href="/"}).fail(function(){$.jAlert({title:"Error",content:"No se ha podido cerrar sesi\xf3n",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]})})}),$("a").not(".link_exclude").click(function(b){b.preventDefault();var a=$(this).attr("href");if("#"==a||0==a.indexOf("#")||$(this).prop("href")==location.href)return!1;0==a.indexOf("http")?window.open(a,"_blank"):window.location.href=a}),url=function(){var a=$(location).attr("pathname");0==a.indexOf("/")&&(a=a.substring(1)),"/"==a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.split("/"),c={module:b[0],method:b[1],id:b[2],options:{}};if(b.length>3)for(i=2;i<b.length;i+=2)c.options[b[i]]=b[i+1];return c}(),connection_fails=0,setInterval(function(){$.ajax({method:"POST",url:"index/keep_alive/",data:url,dataType:"json"}).done(function(a){a.alive?connection_fails=0:location.reload()}).fail(function(){++connection_fails>1&&location.reload()})},3e4),$(".link_button").click(function(){location.href=$(this).data("href")}),set_date_picker=function(){$(this).removeClass("hasDatepicker"),$(this).removeAttr("id"),$(this).datepicker({dateFormat:$(this).data("format")||"dd/mm/yy",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Deciembre"],dayNamesMin:["Dom","Lun","Mar","Mie","Jue","Vie","Sab"]})},$(".date_input").each(set_date_picker),window.onbeforeprint=function(){$(".content_viewer").css({"overflow-y":"auto",height:"auto"})},$(".menu_item").click(function(){$(this).css({opacity:"0.1",transform:"scale(2)"})}),$("#nav_content a").each(function(){(a_module=$(this).attr("href").replace("/",""))==url.module&&$(this).addClass("nav_link_active")}),$("body").on("keydown",a=>{("I"==a.key||"i"==a.key)&&a.altKey&&(location.href="/"),("V"==a.key||"v"==a.key)&&a.altKey&&(location.href="/Ventas/"),("C"==a.key||"c"==a.key)&&a.altKey&&(location.href="/Compras/"),("T"==a.key||"t"==a.key)&&a.altKey&&(location.href="/Catalogo/"),("R"==a.key||"r"==a.key)&&a.altKey&&(location.href="/Reportes/"),("A"==a.key||"a"==a.key)&&a.altKey&&(location.href="/Ajustes/")}),$(document).tooltip(),$("#menu_button").click(function(){"#"==$(this).attr("href")&&$("#main_nav").slideToggle("slow")}),$("#tabs").accordion({collapsible:!0,heightStyle:"content",activate:function(){$("textarea").trigger("input")}}),$(".back_button").click(function(){history.back()})});
$(function(){function a(){null==url.method&&(url.method="listar");var a=url.module+"/"+url.method+"/";$.each(url.options,function(c,b){null!=b&&0!=b&&(a+=c+"/"+b+"/")}),location.href=a}$(".data_viewer").each(function(){(function(b){var c=$("#"+b),d=c.find(".template").clone().removeClass("template").prop("outerHTML");$.ajax({method:"POST",url:url.module+"/"+b+"_loader/",data:url,dataType:"json"}).done(function(e){if(null!=e.content&&($.each(e.content,function(e,a){var c=d;$.each(a,function(a,b){c=c.replace(new RegExp("{{"+a+"}}","g"),b)}),$("#"+b+" tbody").append(c)}),$("#"+b+" tbody tr").click(function(){$(this).data("href")&&(location.href=$(this).data("href")+"/"+$(this).data("id")+"/")}),e.foot&&$.each(e.foot,function(a,c){tr=(tr=$("#"+b+" tfoot").html()).replace(new RegExp("{{"+a+"}}","g"),c),$("#"+b+" tfoot").html(tr)})),null!=e.found_rows){var f=0;f=null==url.options.page?e.found_rows>0?1:0:url.options.page,$(".pagination").jqPagination({paged:function(b){url.options.page=b,a()},max_page:Math.ceil(e.found_rows/100),current_page:f,page_string:"{current_page} / {max_page}"})}c.show(),c.data("type")||c.floatThead({scrollContainer:!0}),e.load_after&&$.each(e.load_after,function(a,b){$("."+a).text(b)})}).fail(function(){$("div.loading_error").show()}).always(function(){$("div.loading_data").hide()})})($(this).attr("id"))}),$(".content_loader").each(function(){var a,b;a=$(this).attr("id"),b=$("#"+a),module=url.module||"index",$.ajax({method:"POST",url:module+"/"+a+"_loader/",data:url,dataType:"html"}).done(function(a){b.html(a),$(".menu_item").click(function(){$(this).css({opacity:"0.1",transform:"scale(2)"})}),$("#main_content").has(".details_content").addClass("details_main_content"),$(".close_details").click(function(a){a.preventDefault(),$(".details_content").css({opacity:"0.1",transform:"scale(0.1)"}),history.back()}),$(".link_button").click(function(){location.href=$(this).data("href")}),b.find(".print_button").click(function(){print_header=null,$(".print_header").length&&(print_header=$(".print_header").html()),print_footer=null,$(".print_footer").length&&(print_footer=$(".print_footer").html()),$($(this).data("print")).printThis({loadCSS:$(this).data("css")||"",header:print_header,footer:print_footer})}),$(".open_dialog_button").click(function(){$("#"+$(this).data("dialog")).dialog("open")}),$(".delete_button").length&&$(".delete_button").click(delete_button_click),b.find(".data_viewer").show(),$(".link_row").click(function(){"#"!=$(this).data("href")&&(location.href=$(this).data("href"))}),$(".myChart").length>0&&init_chart()}).fail(function(){$("div.loading_error").show()}).always(function(){$("div.loading_data").hide()})}),$(".data_search").keyup(function(){var a=$(this).val();$(".data_viewer tbody tr").not(".template").each(function(){found=!1,$(this).find("td").each(function(){$(this).text().toUpperCase().indexOf(a.toUpperCase())>=0&&(found=!0)}),found?$(this).show():$(this).hide()})}),$(".data_filter").each(function(){var b,c,d;$(this).is("select")?(b=$(this).attr("id"),c=url.module||"index",null!=(d=$("#"+b)).data("module")&&(c=d.data("module")),$.ajax({method:"POST",url:c+"/"+b+"_loader/",data:url,dataType:"json"}).done(function(b){if(b.results){var c={data:b.results,dropdownAutoWidth:!0,placeholder:d.data("placeholder")||"",width:d.data("width")||"resolve"};("none"!=d.data("search")||"none"==d.data("default"))&&(item=$(document.createElement("option"))).appendTo(d),"none"==d.data("search")&&(c.minimumResultsForSearch=1/0),d.select2(c),null!=d.data("value")&&(d.val(d.data("value")),d.trigger("change.select2")),d.data("identifier")&&(url.options[d.data("identifier")]&&(d.val(url.options[d.data("identifier")]),d.trigger("change.select2")),d.change(function(){url.options[d.data("identifier")]=d.val(),a()}))}}).fail(function(){d.hide()}).always(function(){})):$(this).change(function(){$(this).is(".date_input")&&($(this).data("value",$(this).val()),$(this).val($.datepicker.formatDate("yy-mm-dd",$(this).datepicker("getDate")))),url.options[$(this).data("identifier")]=$(this).val(),a()})}),$(".print_button").click(function(){$(".data_viewer").length>0&&$($(this).data("print")).floatThead("destroy");var a=null;$(".print_header").length&&(a=$(".print_header").html());var b=null;$(".print_footer").length&&(b=$(".print_footer").html());var c="public/styles/print_list.css?r="+Math.floor(1e5*Math.random());void 0!==$($(this).data("print")).data("css")&&(c=$($(this).data("print")).data("css")),$($(this).data("print")).printThis({loadCSS:c,header:a,footer:b})})});
$(function(){function f(){$(".data_selector:not(.select2-hidden-accessible)").each(function(){var a=$(this);if(900>$(window).width()&&a.data("width","100%"),null!=json[a.data("source")]){("none"!=a.data("search")||"none"==a.data("default"))&&(item=$(document.createElement("option"))).appendTo(a);var b={data:json[a.data("source")],dropdownAutoWidth:!0,placeholder:a.data("placeholder")||"",width:a.data("width")||"resolve"};"none"==a.data("search")&&(b.minimumResultsForSearch=1/0),a.select2(b),null!=a.data("value")&&(a.val(a.data("value")),a.trigger("change.select2"))}}),$("#bill_type").change(),$(".entry_selector").change(),building_entry_selector=!1}function g(a){a.fadeIn(),setTimeout(function(){a.fadeOut("slow")},5e3)}function h(b){var c=b.closest("tr").find(".row_quantity").val(),a=b.closest("tr").find(".row_price").val(),d=b.closest("tr").find(".row_total").find("span");if(""!=c||isNaN(a)){if(isNaN(c)||isNaN(a))d.text("0.00");else{var e=c*a;d.text(e.toFixed(2))}}else d.text(parseFloat(a).toFixed(2))}function a(n){if(13==n.which){var k=$(this).closest("tbody");if(k.is(".locked_tbody"))return!1;if($(this).closest("tr").is(":last-child")){var l=$(this).closest("tr").find(".row_price"),m=$(this).closest("tr").find(".row_product_name");if(""==m.val())return m.focus(),!1;if(""==l.val())return l.focus(),!1;$(this).closest("tr").find(".data_selector").each(function(){$(this).select2("destroy")});var g=$(this).closest("tr").clone();k.append(g),g.find(".row_count").text(k.find("tr").length),g.find("input").first().focus(),g.find("input").val(""),g.find(".row_number").val(k.find("tr").length-1),g.find(".clearable").text(""),g.find(".date_input").each(set_date_picker),g.find("input").keypress(a),g.find(".row_quantity, .row_price").change(function(){h($(this)),i()}),g.find(".row_total").find("span").text("0.00"),g.find(".delete_row_icon").click(delete_row_click),$(".delete_row_icon").css({visibility:"visible"}),g.find(".complete_value").text(""),g.find(".complete_value").click(c),g.find(".partial_value").show(),g.find(".partial_value").blur(b),g.find(".partial_value").change(d),g.find(".row_generics").text(""),g.find(".local_code").change(e),j(g),f()}return!1}}function i(){var a=0;$(".row_total").each(function(){a+=parseFloat($(this).find("span").text())}),$("#subtotal").val(format_number(a)),$("#iva").val(format_number(.13*a)),2==bill_type?$("#total").val(format_number(1.13*a)):$("#total").val(format_number(a)),$("#paid_amount_input").trigger("change")}function j(a=$("body")){a.find(".list_input").each(function(){$(this).autocomplete({source:json[$(this).data("source")],select:function(b,a){(a.item.id||a.item.local_code)&&((_tr=$(this).closest("tr")).find(".local_code").val(a.item.local_code),_tr.find(".measure_name").text(a.item.measure_name),_tr.find(".cost").text(a.item.cost),_tr.find(".product_id").val(a.item.product_id),_tr.find(".fitem_id").val(a.item.fitem_id),_tr.find(".pres_id").val(a.item.pres_id),_tr.find(".service_id").val(a.item.service_id),_tr.find(".combo_id").val(a.item.combo_id),_tr.find(".gproduct_id").val(a.item.gproduct_id),2!=bill_type?_tr.find(".sale_price").val(a.item.sale_price):_tr.find(".sale_price").val(a.item.nvat_price),_tr.find(".row_available").text(a.item.quantity),""==(row_quantity=_tr.find(".row_quantity").val())&&_tr.find(".row_quantity").val(1),h(_tr),i(),a.item.combo_id?setTimeout(k,50,_tr,a.item.combo_id):_tr.find(".row_generics").html(""))},change:function(b,a){a.item||($(this).val(""),$(this).trigger("change"))},autoFocus:!0}),$(this).click(function(){$(this).select()})})}function k(a,b){var c=a;$.ajax({method:"GET",url:url.module+"/generic_by_combo/"+b,dataType:"json"}).done(function(a){c.find(".row_generics").html(""),$.each(a,function(f,b){var a=$(document.createElement("div")),d=$(document.createElement("span"));d.text(b.product_name+":"),a.append(d);var e=$(document.createElement("select"));e.attr("name","generics[]"),a.append(e),c.find(".row_generics").append(a),$.each(b.options,function(c,b){var a=$(document.createElement("option"));a.attr("value",b.product_id),a.text(b.product_name),e.append(a)})})}).fail(function(){}).always(function(){})}function l(){$.ajax({method:"POST",url:deletion_url,data:url,dataType:"json"}).done(function(a){a.deleted?$.jAlert({title:a.title||"Success",content:a.message||"Deleted succesfully!",theme:"blue",autofocus:".jalert_accept",btns:[{text:a.accept||"OK",closeAlert:!0,theme:"blue",class:"jalert_accept",onClick:function(){location.href=deletion_next}}]}):a.message?$.jAlert({title:a.title||"Message",content:a.message,theme:a.theme||"red",autofocus:".jalert_accept",btns:[{text:a.accept||"OK",closeAlert:!0,theme:a.theme||"red",class:"jalert_accept"}]}):$.jAlert({title:"Error",content:"Failed to delete.",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]})}).fail(function(){}).always(function(){})}function m(a){null==last_form||a.no_reset||(last_form.trigger("reset"),last_form.find(".data_selector").val("").trigger("change"),last_form.find(".clearable").text(""),last_form.find(".deletable").not(":first").remove())}function n(){selected=[],$(".unique_selection").each(function(){selected[selected.length]=$(this).val()}),$(".unique_selection option").each(function(){$(this).removeAttr("disabled")}),$(".unique_selection").each(function(){selected_val=$(this).val(),selector=$(this),selector.find("option").each(function(){$.inArray($(this).val(),selected)>=0&&selected_val!=$(this).val()&&$(this).attr("disabled",!0)}),selector.select2()})}function b(){$(this).val().length>0&&($(this).siblings(".complete_value").text($(this).val()),$(this).siblings(".complete_value").show(),$(this).hide())}function c(){(partial_value=$(this).siblings(".partial_value").first()).show(),partial_value.focus(),partial_value.select(),$(this).hide()}function d(){$(this).siblings(".complete_value").text($(this).val()),0==$(this).val().length&&($(this).siblings(".complete_value").hide(),$(this).show())}function e(){local_code=$(this).val(),list_input=$(this).closest("tr").find(".list_input"),items=json[list_input.data("source")],$.each(items,function(b,a){a.local_code!=local_code&&a.barcode!=local_code||a.pres_id||(list_input.val(a.product_name),list_input.data("ui-autocomplete")._trigger("select","autocompleteselect",{item:a}))})}new_item_row=$(".item_row").first().clone(!0),json=[],action_module="index",null!=url.module&&""!=url.module&&(action_module=url.module),$("#main_content").has(".form_content").addClass("form_main_content"),building_entry_selector=!0,$.ajax({method:"POST",url:action_module+"/load_form_data/",data:url,dataType:"json"}).done(function(k){if((json=k).update&&($(".update_input").each(function(){$(this).val(json.update[$(this).attr("name")]),$(this).data("value",json.update[$(this).attr("name")]),null!=$(this).data("cat_source")&&($(this).data("default_value",json.update[$(this).attr("name")]),$(this).data("default_cat",json.update[$($(this).data("cat_source")).attr("name")]))}),$(".update_radio").each(function(){json.update[$(this).attr("name")]==$(this).attr("value")?$(this).attr("checked","checked"):$(this).removeAttr("checked")}),$(".update_ucheck").each(function(){1==parseInt(json.update[$(this).attr("name")])?$(this).attr("checked","checked"):$(this).removeAttr("checked")}),$(".update_text").each(function(){$(this).text(json.update[$(this).data("id")])})),$(".age_input").trigger("change"),json.check&&$(".update_check").each(function(){var a=$(this);if(json.check[a.data("source")]){var b=!1;$.each(json.check[a.data("source")],function(d,c){c.id==a.attr("value")&&(a.attr("checked","checked"),b=!0)}),b||a.removeAttr("checked")}}),json.items&&($(".items_container").each(function(){var e=$(this);if(json.items[e.data("source")]&&json.items[e.data("source")].length>0){var f=e.find("tr").first().clone(!0);e.find("tr:first").first().remove(),row_count=0,$.each(json.items[e.data("source")],function(l,k){var g=f.clone(!1);g.find(".date_input").each(set_date_picker),g.find("input").keypress(a),g.find(".row_quantity, .row_price").change(function(){h($(this)),i()}),g.find(".delete_row_icon").click(delete_row_click),j(g),g.find(".row_number").val(row_count),g.find(".row_count").text(++row_count),g.find(".row_available").text(k.available),g.find(".row_quantity").val(k.quantity),g.find(".row_price").val(k.price),$.each(k,function(a,b){g.find("input."+a).val(b),g.find("select."+a).data("value",b),g.find("span."+a).text(b)}),k.pres_id&&g.find(".pres_id").val(k.pres_id),h(g),e.append(g),g.find("input").first().focus(),g.find(".complete_value").text(k.product_name),g.find(".complete_value").click(c),g.find(".complete_value").show(),g.find(".partial_value").hide(),g.find(".partial_value").blur(b),g.find(".partial_value").change(d),g.find(".row_generics").text("")}),row_count>1&&$(".delete_row_icon").css({visibility:"visible"}),i()}}),$(".current").change(calculate_consumption),$(".current").trigger("change")),json.presentations)for(i=0,trs=$("#pres_container tr");i<trs.length&&i<json.presentations.length;i++){var e=json.presentations[i];(_tr=$(trs.get(i))).find(".pres_id").val(e.pres_id),_tr.find(".pres_name").val(e.pres_name),_tr.find(".pres_price").val(e.price),_tr.find(".pres_units").val(e.units)}if(null!=json.found_rows){var g=0;g=null==url.options.page?json.found_rows>0?1:0:url.options.page,$(".pagination").jqPagination({paged:function(a){url.options.page=a,null==url.method&&(url.method="listar"),href=url.module+"/"+url.method+"/",$.each(url.options,function(b,a){null!=a&&(href+=b+"/"+a+"/")}),location.href=href},max_page:Math.ceil(json.found_rows/100),current_page:g,page_string:"{current_page} / {max_page}"})}f(),j(),$(".unique_selection").change(function(){setTimeout(n,500)}),n(),$("textarea").trigger("input")}).fail(function(){}).always(function(){}),close_dialog=null,add_selector=null,last_form=null,duplicate=!1,$("form").submit(function(a){if(a.preventDefault(),duplicate||(duplicate=!0,setTimeout(function(){duplicate=!1},5e3),e="",f=!0,$(".equal_value").each(function(){""==e?e=$(this).val():$(this).val()!=e&&($.jAlert({title:"Error",content:"Las contrase\xf1as no coinciden",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]}),f=!1)}),!f))return!1;var e,f,b=$(this).attr("action")||"save";$(this).find(".date_input").each(function(){$(this).data("value",$(this).val()),$(this).val($.datepicker.formatDate("yy-mm-dd",$(this).datepicker("getDate")))});var c=new FormData(this);first_input=$(this).find("input").first(),div_sending=$(this).siblings(".sending"),div_success=$(this).siblings(".success"),div_error=$(this).siblings(".error"),div_sending.show(),close_dialog=$(this).data("close_dialog"),add_selector=$(this).data("selector"),last_form=$(this),null!=$(this).data("module")&&(action_module=$(this).data("module"));var d={method:"POST",url:action_module+"/"+b+"/",data:c,dataType:"json",processData:!1,contentType:!1};$.ajax(d).done(function(a){var b,c;a.message&&$.jAlert({title:a.title,content:a.message,theme:a.theme,autofocus:".jalert_accept",onClose:function(){first_input.focus(),a.reload_after&&location.reload(),a.print_after&&($(".form_body").printThis(),$(".reload_button").show(),$(".reload_button").siblings().hide()),a.redirect_after&&(m(a),location.href=a.redirect_after)},btns:[{text:a.accept||"Accept",closeAlert:!0,theme:a.theme,class:"jalert_accept"}]}),a.success||a.saved?(b=a,(c=div_success).fadeIn(),null!=add_selector&&(source=$("#"+add_selector).data("source"),json[source][json[source].length]=b,$("#"+add_selector).select2({data:json[source]}),$("#"+add_selector).val(b.id).trigger("change")),null==close_dialog||b.reload_after?setTimeout(function(){c.fadeOut("slow")},5e3):($("#"+close_dialog).dialog("close"),close_dialog=null),m(b)):null!=a.next?(m(a),location.href=a.next):a.reload?location.reload():g(div_error)}).fail(function(){g(div_error)}).always(function(){div_sending.hide(),$(".date_input").each(function(){null!=$(this).data("value")&&($(this).val($(this).data("value")),$(this).removeAttr("data-value"))})})}),$("form .cancel_button").click(function(){$(this).closest("form").data("reset")&&($(".form_content").css({opacity:"0.1",transform:"scale(0.1)"}),history.back())}),$(".close_form").click(function(a){a.preventDefault(),$(".form_content").css({opacity:"0.1",transform:"scale(0.1)"}),history.back()}),$(window).bind("beforeprint",function(){$("input, textarea").each(function(){$(this).parent().find(".no_screen").text($(this).val())}),$("select").each(function(){$(this).parent().find(".no_screen").text($(this).find("option:selected").text())})}),bill_type=1,$(".row_quantity, .row_price").change(function(){h($(this)),i()}),$(".details_table input").keypress(a),format_number=function(a){return new Number(a).toLocaleString("en-US",{style:"currency",currency:"USD"}).substr(1)},$("#bill_type").change(function(){var a=$(this).val();2==a?$("#vat_total, #subtotal_div").show():$("#vat_total, #subtotal_div").hide(),3==a?($("#bill_number").val(json.ticket),$("#bill_number").attr("type","number")):($("#bill_number").val(""),$("#bill_number").attr("type","text")),""==a&&JSON.ticket++,bill_type=a}),$(".classifier_input").change(function(){$(".content_viewer").css("visibility","hidden"),$(".classifier_button").show(),$(".print_button").hide()}),$("#paid_amount_input").change(function(){var c=parseFloat($(this).val()),a=$("#total").val();a=parseFloat(a.replace(",",""));var b=c-a;isNaN(b)?$("#change_input").val(""):$("#change_input").val(b.toFixed(2))}),delete_button_click=function(){deletion_url=$(this).data("url"),deletion_next=$(this).data("next"),$.jAlert({title:"Confirmar",content:"\xbfConfirma que desea borrar este registro?",theme:"red",autofocus:".jalert_cancel",btns:[{text:"Confirmar",closeAlert:!0,theme:"red",class:"jalert_accept",onClick:l},{text:"Cancelar",closeAlert:!0,theme:"gray",class:"jalert_cancel"}]})},$(".delete_button").click(delete_button_click),$(".reload_button").click(function(){location.reload()}),delete_row_click=function(a){if(a.preventDefault(),delete_button=$(this),tbody=$(this).closest("tbody"),row_count=tbody.find("tr").length,row_count<2)return!1;$.jAlert({title:"Confirmar",content:"\xbfEst\xe1 seguro de que desea eliminar la fila?",theme:"red",autofocus:".jalert_cancel",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept",onClick:function(){null!=(product_id=delete_button.closest("tr").find(".product_id").val())&&""!=product_id&&(removed=delete_button.closest("tr").find(".item_id").val(),(input=$(document.createElement("input"))).val(removed),input.attr("name","removed[]"),input.attr("type","hidden"),delete_button.closest("form").append(input)),null!=(service_id=delete_button.closest("tr").find(".service_id").val())&&""!=service_id&&(removed=delete_button.closest("tr").find(".item_id").val(),(input=$(document.createElement("input"))).val(removed),input.attr("name","removed_services[]"),input.attr("type","hidden"),delete_button.closest("form").append(input)),delete_button.closest("tr").remove(),i(),row_count=0,tbody.find(".row_count").each(function(){$(this).text(++row_count)}),row_number=0,tbody.find(".row_number").each(function(){$(this).val(row_number++)}),row_count<2&&$(".delete_row_icon").css({visibility:"hidden"})}},{text:"Cancelar",closeAlert:!0,theme:"darkgray",class:"jalert_cancel"}]})},$(".delete_row_icon").click(delete_row_click),$(".code_generator").change(function(){var a=$(this).select2("data")[0],b=$($(this).data("code_input"));null!=b.data("default_cat")&&a.id==b.data("default_cat")?b.val(b.data("default_value")):null!=a.next&&b.val(""+a.category_prefix+a.next+a.category_suffix)}),$(".add_row_button").click(function(){var g=$($(this).data("tbody"));null==g&&(g=$(".items_container").first());var k=g.find("tr").last();k.find(".data_selector").each(function(){$(this).select2("destroy")}),_tr=k.clone(),g.append(_tr),_tr.find(".row_count").text(g.find("tr").length),_tr.find("input").first().focus(),_tr.find("input").val(""),_tr.find(".row_number").val(g.find("tr").length-1),_tr.find(".date_input").each(set_date_picker),_tr.find("input").keypress(a),_tr.find(".row_quantity, .row_price").change(function(){h($(this)),i()}),_tr.find(".row_total").find("span").text("0.00"),_tr.find(".delete_row_icon").click(delete_row_click),_tr.find(".clearable").text(""),$(".delete_row_icon").css({visibility:"visible"}),_tr.find(".complete_value").text(""),_tr.find(".complete_value").click(c),_tr.find(".row_generics").text(""),_tr.find(".partial_value").show(),_tr.find(".partial_value").blur(b),_tr.find(".partial_value").change(d),_tr.find(".local_code").change(e),j(_tr),f()}),$(".add_entry_button").click(function(){(last_entry=(container=$($(this).data("container"))).find(".form_entry").last()).find(".data_selector").each(function(){$(this).select2("destroy")}),entry=last_entry.clone(),container.append(entry),entry.find(".entry_count").text(container.find(".form_entry").length),entry.find("input").first().focus(),entry.find("input").val(""),entry.find(".date_input").each(set_date_picker),entry.find(".extra_data").text(""),$(".delete_entry_icon").css({visibility:"visible"}),j(entry),f()}),$(".input-images").length&&$(".input-images").imageUploader({label:"Arrastre aqu\xed una imagen, o haga click para buscarla.",maxFiles:1}),$(".entry_selector").change(function(a){value=$(a.target).val(),$(".hidden_entry").hide(),$(".hidden_entry").find("input").each(function(){building_entry_selector||$(this).val(""),$(this).removeAttr("required")}),$(".hidden_entry").find("select").each(function(){building_entry_selector||$(this).val(""),$(this).removeAttr("required")}),$(".entry_type_"+value).show(),$(".entry_type_"+value).find("input").each(function(){null!=$(this).data("required")&&$(this).attr("required",!0)}),$(".entry_type_"+value).find("select").each(function(){null!=$(this).data("required")&&$(this).attr("required",!0)})}),$(".entry_type_"+$(".entry_selector").data("default")).show(),$("textarea").each(function(){min_height=30,(min_height=this.scrollHeight>this.style.height?this.scrollHeight:this.style.height)<30&&(min_height=30),this.setAttribute("style","height:"+min_height+"px;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),$(".age_input").change(function(){if(""==$(this).val())return!0;date=$.datepicker.formatDate("yy-mm-dd",$(this).datepicker("getDate")),age_span=$(this).next("span"),$.ajax({method:"GET",url:"index/age_calculation/"+date,dataType:"json"}).done(function(a){a.age&&age_span.text(a.age)}).fail(function(){}).always(function(){})}),$(".partial_value").blur(b),$(".complete_value").click(c),$(".partial_value").change(d),$(".image-upload").length>0&&$("#photo").imageReader(),$(".local_code").change(e),$(".check_identifier").change(function(){$(".identifier_clean").val(""),check_url=url.module+"/check_identifier/"+$(this).val(),null!=$(".list_selector").val()&&""!=$(".list_selector").val()&&(check_url+="/"+$(".list_selector").val()+"/"),$.ajax({method:"GET",url:check_url,dataType:"json"}).done(function(a){a.found&&$.jAlert({title:"Entrada duplicada",content:"El(la) sr(a) "+a.complete_name+" ya se encuentra en la lista seleccionada.",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]}),$.each(a,function(a,b){$("."+a).val(b)})}).fail(function(){}).always(function(){})}),calculate_consumption=function(){if(previous_value=parseInt((tr=$(this).closest("tr")).find(".previous").text()),current_value=parseInt($(this).val()),consumption_span=tr.find(".consumption"),isNaN(previous_value)||isNaN(current_value))return!1;(consumption=current_value-previous_value)<0?($.jAlert({title:"Error",content:"La lectura no puede ser inferior a "+previous_value+".",theme:"red",autofocus:".jalert_accept",btns:[{text:"Aceptar",closeAlert:!0,theme:"red",class:"jalert_accept"}]}),consumption_span.text("")):consumption_span.text(consumption)}});
$(function(){dialog_width=500,600>$(window).width()&&(dialog_width=-1!=navigator.userAgent.indexOf("AppleWebKit")?"-webkit-fill-available":"-moz-available"),$.extend($.ui.dialog.prototype.options,{modal:!0,autoOpen:!1,show:{effect:"explode",duration:500},hide:{effect:"explode",duration:500},width:dialog_width,maxWidth:500,open:function(){$("#container").css("opacity","0.2")},close:function(){var a=$(this).find("form");a.trigger("reset"),$("#container").css("opacity","1"),a.find("select").trigger("change.select2")}}),$.ui.dialog.prototype._allowInteraction=function(a){return!0},$(".open_dialog_button").click(function(){$("#"+$(this).data("dialog")).dialog("open")}),$(".dialog").each(function(){options={buttons:{[$(this).data("accept")||"Agregar"]:function(a){$(this).find("form").submit()},Cerrar:function(){$(this).dialog("close")}}},$(this).dialog(options),$(this).data("reload")&&$(this).dialog("option","close",function(){location.reload()})})});
$(function(){function a(){var a=0;$(".order_item").each(function(){a+=$(this).find(".price_input").val()*$(this).find(".quantity_input").val()}),$("#form_total").text(a.toFixed(2))}$(".price_input, .quantity_input").change(a),$(".order_item a").click(function(){var b=$(this).parent().find(".quantity_input"),c=""==b.val()?0:parseInt(b.val());b.val(c+1),a()})});
$(function(){$(".parent_checkbox").click(function(){$(this).closest(".parent_item").find(".child_checkbox").prop("checked",$(this).prop("checked"))}),$(".child_checkbox").click(function(){var a=$(this).closest(".parent_item").find(".parent_checkbox"),b=$(this).closest(".children_container");$(this).prop("checked")?a.prop("checked",!0):0==b.find("input:checked").length&&a.prop("checked",!1)}),$(".children_container").sortable()});
$(function(){init_chart=function(){$(".myChart").each(function(){a($(this))})};function a(a){var c=new Chart(a,{type:"bar",data:{labels:a.data("labels").split(","),datasets:[{label:"Metros c\xfabicos",data:a.data("data").split(","),backgroundColor:["#000","#000","#000","#000","#000","#000"]}]},options:{scales:{y:{beginAtZero:!0}},plugins:{datalabels:{anchor:"end",align:"top",formatter:Math.round,font:{weight:"bold"}}}},plugins:[ChartDataLabels],legend:{display:!1},tooltips:{callbacks:{label:a=>`${a.yLabel}: ${a.xLabel}`,title:()=>null}}}),d=a.parent().next(".small_chart").first(),b=$(document.createElement("img"));b.attr("src",c.toBase64Image()),b.css("width","100%"),d.html(b),a.parent().remove()}});
